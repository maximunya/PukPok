{% extends 'base.html' %}
{% load static %}

{% block title %}
{{ page_user }}
{% endblock %}

{% block content %}
<main class="profile_page_main">
  <div class="user_header">
    <div class="card text-white bg-dark mb-5" style="border: 1px solid #111;">
      <div class="card-header" style="display: flex; justify-content: space-between; margin: 0; padding: 5px;">
        <h2 class="username">{{ page_user }}</h2>
        <h5 class="username">
          <div class="links">
          {% if page_user.link1 %}
            <div class="link1"><a href="{{ page_user.link1 }}" class="link">ВКонтакте</a></div>
          {% endif %}
          {% if page_user.link2 %}
            <div class="link2">|<a href="{{ page_user.link2 }}" class="link">Instagram</a></div>
          {% endif %}
          {% if page_user.link3 %}
            <div class="link3">|<a href="{{ page_user.link3 }}" class="link">Telegram</a></div>
          {% endif %}
          {% if page_user.link4 %}
            <div class="link4">|<a href="{{ page_user.link4 }}" class="link">TikTok</a></div>
          {% endif %}
          </div>
        </h5>
      </div>
      <div class="card-body text-white">
        <div class="pic_and_bio">
          <div class="div_profile_page_picture">
          {% if page_user.profile_pic %}
            <img class="profile_page_picture" src="{{ page_user.profile_pic.url }}" alt="-">
          {% else %}
            <img class="profile_page_picture" src="{% static 'PukPok/img/дефолтная-ава.jpeg' %}" alt="-">
          {% endif %}
          </div>
          <div class="bio_and_links">
            <h5 class="card-title">bio: &ensp; {{ page_user.bio }}</h5>
            <hr>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="page_content">
    {% if user.is_authenticated %}
      {% if user.id == page_user.id %}
        <div class="post_form">
          <form class="form" action="{% url 'create_post' %}" method="post">
            {% csrf_token %}
            {{ create_post_form }}
            <button type="submit" class="btn btn-success" style="margin-top: 8px; width: 15%; text-align: center; margin-left: 85%" >Запостить</button>
          </form>

          <script>
            var name = "{{ user.id }}";
            document.getElementById("name").value = name;

          </script>

        </div>
      {% endif %}
    {% endif %}  
    <div class="posts">
          {% for post in posts %}
          <div class="post">
            <div class="whole_post">
              <div class="profile_pic">
                <a href="{% url 'profile_page' post.author.profile.id %}">
                  {% if post.author.profile.profile_pic %}
                  <img class="profile_pic" src="{{ post.author.profile.profile_pic.url }}" alt="-">
                  {% else %}
                  <img class="profile_pic" src="{% static 'PukPok/img/дефолтная-ава.jpeg' %}" alt="-">
                  {% endif %}
                </a>
              </div>
              <div class="alert alert-dark">
                <a href="{% url 'profile_page' post.author.profile.id %}" class="profile_url"><p class="post_author">{{ post.author.username }}</p></a>
                <p class="post_content">{{ post.content }}</p>
                <div class="post_info">
                  <div class="post_likes">
                    <form action="{% url 'like_post' post.pk %}" method="POST" class="likes_info">
                      {% csrf_token %}
                      <button type="submit" name="post_id" value="{{ post.id }}" class="like_post">❤</button>
                      <div class="total_likes">
                        {{ post.total_likes }}
                      </div>
                    </form>
                  </div>
                  <p class="pub_date">{{ post.posted_at|date:"d M в H:i" }}</p>
                </div>
                <hr>
                <p class="p_comments">Комментарии</p>
                {% if post.comments.all %}
                {% for comment in post.comments.order_by %}
                <div class="comments">
                  <div class="whole_comments">
                    <div class="profile_pic_comments">
                      <a href="{% url 'profile_page' comment.author.profile.id %}">
                      {% if comment.author.profile.profile_pic %}
                      <img class="profile_pic_comments" src="{{ comment.author.profile.profile_pic.url }}" alt="-">
                      {% else %}
                      <img class="profile_pic_comments" src="{% static 'PukPok/img/дефолтная-ава.jpeg' %}" alt="-">
                      {% endif %}
                      </a>
                    </div>
                    <div class="comment">
                      <a href="{% url 'profile_page' comment.author.profile.id %}" class="profile_url"><p class="comment_author">{{ comment.author.username }}</p></a>
                      <p class="comment_text">{{ comment.comment_text }}</p>
                      <div class="comment_info">
                        <p class="comment_pub_date">{{ comment.comment_posted_at|date:"d M в H:i" }} &ensp; | &ensp; <a href="#" class="answer">Ответить</a></p>
                        <div class="comment_likes">
                          <form action="{% url 'like_comment' comment.pk %}" class="comment_likes_info" method="POST">
                          {% csrf_token %}
                            <button type="submit" name="comment_id" value="{{ comment.id }}" class="like">
                            ❤
                            </button>
                            <div class="comment_total_likes">
                              {{ comment.total_likes }}
                            </div>
                          </form>
                        </div>
                      </div>
                    
                    </div>
                  </div>
                  <hr>
                </div>    
                {% endfor %}
                {% else %}
                <p class="no_comments">Комментариев пока нет!</p>
                {% endif %}  
              </div>      
            </div>
          </div>
          {% endfor %}  
        </div>
      </div>  
</main>

{% endblock %}
